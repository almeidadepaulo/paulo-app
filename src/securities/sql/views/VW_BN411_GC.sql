-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN411_GC]'))
DROP VIEW [dbo].[VW_BN411_GC]
GO

-- Tela Geral de Garantia
-- Cria View
CREATE VIEW [dbo].[VW_BN411_GC]
WITH ENCRYPTION
AS
 SELECT 
  BN411.BN411_NR_GRUPO,
  BN411.BN411_NR_INST,
  BN002.BN002_NM_INST,-- AS BN002_NM_INST,
  BN411.BN411_DT_MOVTO,
  BN411.BN411_ST_APROV,
  
  SUM(BN411.BN411_VL_MOVTO) AS TT_VALOR,
  COUNT (*) AS TT_QUANTIDADE

  FROM BN411 AS BN411

  INNER JOIN BN002 AS BN002
  ON 	BN002.BN002_NR_GRUPO    = BN411.BN411_NR_GRUPO
  AND 	BN002.BN002_NR_INST		= BN411.BN411_NR_INST

GROUP BY     
	BN411.BN411_NR_GRUPO,
    BN411.BN411_NR_INST,
	BN002.BN002_NM_INST,
	BN411.BN411_DT_MOVTO,
	BN411.BN411_ST_APROV

GO


