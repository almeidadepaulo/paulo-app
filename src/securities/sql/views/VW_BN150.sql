-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN150]'))
DROP VIEW [dbo].[VW_BN150]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BN150]
WITH ENCRYPTION
AS
  SELECT 
  
  BN150.BN150_NR_CNPJ,
  BN150.BN150_TP_MOVTO,
  BN150.BN150_NR_LOTE,
  BN150.BN150_NR_CONTRA,
  BN150.BN150_NR_SEQ,
  BN150.BN150_NR_CCC,
  BN150.BN150_ST_CCC,
  BN150.BN150_NR_UNIADM,
  BN150.BN150_NR_IDMUTU,
  BN150.BN150_TP_CPFCNPJ,
  BN150.BN150_NR_CPFCNPJ,
  BN150.BN150_NM_CLIENT,
  BN150.BN150_NM_LOGRAD,
  BN150.BN150_NM_BAIRRO,
  BN150.BN150_NM_CIDADE,
  BN150.BN150_SG_UF,
  BN150.BN150_NR_CEP,
  BN150.BN150_DT_NASC,
  BN150.BN150_DT_LIBERA,
  BN150.BN150_VL_FINAM,
  BN150.BN150_VL_RENDA,
  BN150.BN150_QT_PARC,
  BN150.BN150_VL_PARC,
  BN150.BN150_DT_VENCTO,
  BN150.BN150_TX_FINAM,
  BN150.BN150_NR_ERRO,
  BN150.BN150_NR_PROD,
  BN150.BN150_NR_BANCO,
  BN150.BN150_NR_AGENC,
  BN150.BN150_NR_CONTA,
  BN150.BN150_NR_OPESIS,
  BN150.BN150_DT_INCSIS,
  BN150.BN150_DT_ATUSIS,
  
  BN002.BN002_NR_GRUPO,
  BN002.BN002_NR_INST,
  BN002.BN002_NR_CNPJ,
  BN002.BN002_NM_INST,
  BN002.BN002_NR_OPESIS,
  BN002.BN002_DT_INCSIS,
  BN002.BN002_DT_ATUSIS,
  
  BN015.BN015_NR_MENSAG,
  BN015.BN015_NM_MENSAG,
  
  BN004.BN004_NR_PROD,
  BN004.BN004_TP_PROD,
  BN004.BN004_NM_PROD
  
  --BN405.BN405_NR_GRUPO,
    
  
  FROM BN150 AS BN150
  
  LEFT JOIN BN002 AS BN002
  ON BN150.BN150_NR_CNPJ = BN002.BN002_NR_CNPJ
  
 
  --INNER JOIN BN405 AS BN405
  --ON BN405.BN405_NR_GRUPO = BN002.BN002_NR_GRUPO

  
  
  INNER JOIN BN004 AS BN004
  ON BN004.BN004_NR_PROD = BN150.BN150_NR_PROD

  LEFT OUTER JOIN BN015 AS BN015
  ON BN150.BN150_NR_ERRO = BN015.BN015_NR_MENSAG
  AND BN015.BN015_TP_MENSAG = (CASE
    								WHEN  BN004.BN004_TP_PROD <> 'B' THEN 1 -- ERROS REFERENTES O TIPO DE PRODUTO VEÍCULO E CONSIGNADO
									ELSE 0
								END)

GO


