-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BKN011]'))
DROP VIEW [dbo].[VW_BKN011]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BKN011]
WITH ENCRYPTION
AS

	SELECT 
 
	--PARCELA
	BKN011.BKN011_NR_BANCO,
	BKN011.BKN011_NR_CESS,
	BKN011.BKN011_NR_CONTRA,
	BKN011.BKN011_DT_VENCTO,
	BKN011.BKN011_NR_SEQ,
	BKN011.BKN011_NR_ENT,
	BKN011.BKN011_NR_PARC,
	BKN011.BKN011_VL_PARC,
	BKN011.BKN011_ST_PAGTO,
	BKN011_ST_PAGTO_export = (CASE 
								WHEN BKN011_ST_PAGTO = 'S' THEN 'Pago'
								ELSE 'Pendente'
							END),
	BKN011.BKN011_NR_COCESS,
	BKN011.BKN011_NR_PACESS,
	BKN011.BKN011_NR_OPESIS,
	BKN011.BKN011_DT_INCSIS,
	BKN011.BKN011_DT_ATUSIS,
	-- CONTRATO
	BKN010.BKN010_NR_BANCO,
	BKN010.BKN010_NR_CESS,
	BKN010.BKN010_NR_CONTRA,
	BKN010.BKN010_ST_CONTRA,

	BKN010_ST_CONTRA_export = (CASE 
								WHEN BKN010_ST_CONTRA = 'V' THEN 'Vendido'
								ELSE 'Indefinido'
							END),
	BKN010.BKN010_NR_ENT,
	BKN010.BKN010_TP_CPFCNPJ,
	BKN010.BKN010_NR_CPFCNPJ,
	BKN010.BKN010_DT_NASC,
	BKN010.BKN010_TP_SEXO,
	BKN010.BKN010_NR_END,
	BKN010.BKN010_NM_COMPL,
	BKN010.BKN010_NM_TEL,
	BKN010.BKN010_NR_PROD,
	BKN010.BKN010_NR_PRORIG,
	BKN010.BKN010_NM_CLIENT,
	BKN010.BKN010_NM_LOGRAD,
	BKN010.BKN010_NM_BAIRRO,
	BKN010.BKN010_NM_CIDADE,
	BKN010.BKN010_SG_UF,
	BKN010.BKN010_NR_CEP,
	BKN010.BKN010_DT_LIBERA,
	BKN010.BKN010_NR_LOTE,
	BKN010.BKN010_VL_FINAM,
	BKN010.BKN010_VL_PRESENTE,
	BKN010.BKN010_VL_FUTURO,  
	BKN010.BKN010_VL_RENDA,
	BKN010.BKN010_QT_PARC,
	BKN010.BKN010_VL_PARC,
	BKN010.BKN010_DT_VENCTO,
	BKN010.BKN010_TX_FINAM,
	BKN010.BKN010_NR_MKCESS,
	BKN010.BKN010_NR_OPESIS,
	BKN010.BKN010_DT_INCSIS,
	BKN010.BKN010_DT_ATUSIS,
	-- CESSIONÁRIO
	BKN046.BKN046_NM_CESS,
	-- BAIXA
	BKN012.BKN012_NR_TPPAG,
	BKN012.BKN012_DT_PAGTO,
	BKN012.BKN012_VL_PAGO,
	-- PRODUTO
	BKN005.BKN005_NR_BANCO,
	BKN005.BKN005_NR_PROD,
	BKN005.BKN005_NM_PROD,
	BKN005.BKN005_NR_OPESIS,
	BKN005.BKN005_DT_INCSIS,
	BKN005.BKN005_DT_ATUSIS,
	-- EMISSOR
	BKN002_NR_CESS,
	BKN002_NM_CESS

 
  FROM BKN011 AS BKN011
  
  
  LEFT JOIN BKN002 AS BKN002 -- EMISSOR
  ON  BKN002.BKN002_NR_BANCO = BKN011.BKN011_NR_BANCO
  AND BKN002.BKN002_NR_CESS  = BKN011.BKN011_NR_CESS

    
  LEFT JOIN BKN010 AS BKN010 -- CONTRATO - DADOS SACADO
  ON  BKN010.BKN010_NR_CONTRA	= BKN011.BKN011_NR_CONTRA
  AND BKN010.BKN010_NR_CESS		= BKN011.BKN011_NR_CESS
  AND BKN010.BKN010_NR_BANCO 	= BKN011.BKN011_NR_BANCO

  INNER JOIN BKN046 AS BKN046 -- CESSIONARIO
  ON 	BKN046.BKN046_NR_BANCO  = BKN010.BKN010_NR_BANCO
  AND	BKN046.BKN046_NR_CESS	= BKN010.BKN010_NR_MKCESS
  
  LEFT JOIN BKN005 AS BKN005 -- PRODUTO
   ON 	BKN005.BKN005_NR_BANCO 	= BKN010.BKN010_NR_BANCO
  AND	BKN005.BKN005_NR_PROD	= BKN010.BKN010_NR_PROD  
  
  
  LEFT JOIN BKN012 AS BKN012 -- CONTRATO - DADOS SACADO
  ON  BKN012.BKN012_NR_CONTRA	= BKN011.BKN011_NR_CONTRA
  AND BKN012.BKN012_NR_CESS		= BKN011.BKN011_NR_CESS
  AND BKN012.BKN012_NR_BANCO 	= BKN011.BKN011_NR_BANCO




GO


