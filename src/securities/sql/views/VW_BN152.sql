-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN152]'))
DROP VIEW [dbo].[VW_BN152]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BN152]
WITH ENCRYPTION
AS
  SELECT 
  BN152.BN152_NR_CNPJ,
  BN152.BN152_TP_MOVTO,
  BN152.BN152_NR_LOTE,
  BN152.BN152_NR_CONTRA,
  BN152.BN152_NR_SEQ,
  BN152.BN152_NR_CHASSI,
  BN152.BN152_NR_SEQGAR,
  BN152.BN152_NR_CCC,
  BN152.BN152_ST_CCC,
  BN152.BN152_NM_FABRIC,
  BN152.BN152_DT_FABRIC,
  BN152.BN152_NR_ERRO,
  BN152.BN152_NR_OPESIS,
  BN152.BN152_DT_INCSIS,
  BN152.BN152_DT_ATUSIS,
  
  VW_BN405.BN405_NR_CPFCNPJ,
  VW_BN405.BN002_NM_INST,
  VW_BN405.BN405_NR_GRUPO,
  VW_BN405.BN002_NR_INST


  FROM BN152 AS BN152

  INNER JOIN VW_BN405 AS VW_BN405
  ON  BN152.BN152_NR_LOTE 	 = VW_BN405.BN405_NR_LOTE
  AND BN152.BN152_NR_CONTRA  = VW_BN405.BN405_NR_CONTRA
  
  AND   BN152.BN152_TP_MOVTO 	= 'D'
  AND  	BN152.BN152_NR_ERRO     = 0

GO


