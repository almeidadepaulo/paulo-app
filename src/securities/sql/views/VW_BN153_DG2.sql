-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN153_DG2]'))
DROP VIEW [dbo].[VW_BN153_DG2]
GO

-- Relatório Diário de Garantias

-- Cria View
CREATE VIEW [dbo].[VW_BN153_DG2]
WITH ENCRYPTION
AS
SELECT
  BN153.BN153_NR_GRUPO,
  BN153.BN153_NR_INST,
  BN153.BN153_DT_BASE,
  BN153.BN153_NR_PROD,
  BN153.BN153_NR_LOTE,
  BN153.BN153_NR_CONTRA,
  BN153.BN153_DT_PVCTO,
  BN153.BN153_DT_UVCTO,
  BN153.BN153_QT_PAREX,
  BN153.BN153_VL_PARC,
  BN153.BN153_TT_NOM,
  BN153.BN153_TT_PRES,
  BN153.BN153_TT_EXIG,
  BN153.BN153_DT_INCSIS,

-- CONTRATO
 BN150.BN150_TP_CPFCNPJ,
  ISNULL(BN150.BN150_NR_CPFCNPJ,'0') AS BN150_NR_CPFCNPJ,
  BN150.BN150_NR_CONTA,
  BN150_DT_NASC,
  BN150_TX_FINAM,

--  BN150.BN403_ST_PAGTO,
 

-- CONTA/ENTIDADE
  BN009.BN009_NR_BANCO,
  BN009.BN009_NR_AGENC,
  BN009.BN009_NR_CONTA,
  BN009.BN009_NM_CONTA,
  
  BN002.BN002_NM_INST,

-- PRODUTO  
  BN004_NM_PROD,
  BN004_NR_VOL48,
  BN004_NR_VOL60
  
 
FROM BN153 AS BN153


LEFT JOIN BN002 AS BN002 -- INSTITUICAO
ON  BN002.BN002_NR_GRUPO   = BN153.BN153_NR_GRUPO
AND BN002.BN002_NR_INST    = BN153.BN153_NR_INST

 
LEFT JOIN BN150 AS BN150 -- CONTRATO
ON  BN150.BN150_NR_CNPJ     = BN002.BN002_NR_CNPJ
AND BN150.BN150_NR_LOTE     = BN153.BN153_NR_LOTE
AND BN150.BN150_NR_CONTRA   = BN153.BN153_NR_CONTRA
AND BN150_TP_MOVTO			= 'D'



LEFT OUTER JOIN BN009 AS BN009  -- CONTA
ON  BN009.BN009_NR_BANCO 	=  BN150.BN150_NR_BANCO
AND BN009.BN009_NR_AGENC 	=  BN150.BN150_NR_AGENC
AND BN009.BN009_NR_CONTA 	=  BN150.BN150_NR_CONTA


LEFT OUTER JOIN BN004 AS BN004  -- PRODUTO
ON  BN004.BN004_NR_PROD 	=  BN150.BN150_NR_PROD




GO


