-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BKN010]'))
DROP VIEW [dbo].[VW_BKN010]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BKN010]
WITH ENCRYPTION
AS

  SELECT 
  
  BKN010.BKN010_NR_BANCO,
  BKN010.BKN010_NR_CEDE,
  BKN010.BKN010_NR_CONTRA,
  BKN010.BKN010_ST_CONTRA,

  BKN010_ST_CONTRA_export = (CASE 
								WHEN BKN010_ST_CONTRA = 'V' THEN 'Vendido'
								ELSE 'Indefinido'
							END),
  BKN010.BKN010_NR_ENT,
  BKN010.BKN010_TP_CPFCNPJ,
  BKN010.BKN010_NR_CPFCNPJ,
  BKN010.BKN010_DT_NASC,
  BKN010.BKN010_TP_SEXO,
  BKN010.BKN010_NR_END,
  BKN010.BKN010_NM_COMPL,
  BKN010.BKN010_NM_TEL,
  BKN010.BKN010_NR_PROD,
  BKN010.BKN010_NR_PRORIG,
  BKN010.BKN010_NM_CLIENT,
  BKN010.BKN010_NM_LOGRAD,
  BKN010.BKN010_NM_BAIRRO,
  BKN010.BKN010_NM_CIDADE,
  BKN010.BKN010_SG_UF,
  BKN010.BKN010_NR_CEP,
  BKN010.BKN010_DT_LIBERA,
  BKN010.BKN010_NR_LOTE,
  BKN010.BKN010_VL_FINAM,
  BKN010.BKN010_VL_PRESENTE,
  BKN010.BKN010_VL_FUTURO,  
  BKN010.BKN010_VL_RENDA,
  BKN010.BKN010_QT_PARC,
  BKN010.BKN010_VL_PARC,
  BKN010.BKN010_DT_VENCTO,
  BKN010.BKN010_TX_FINAM,
  BKN010.BKN010_NR_MKCESS,
  BKN010.BKN010_NR_OPESIS,
  BKN010.BKN010_DT_INCSIS,
  BKN010.BKN010_DT_ATUSIS,
  
  -- CESSINÁRIO
  VW_BKN100.BN001_NM_GRUPO,

  -- PRODUTO
  BN004.BN004_NM_PROD
  /*
  VW_BKN100.CCB_COUNT,
  VW_BKN100.CONSIGNADO_COUNT,
  VW_BKN100.VEICULO_COUNT,
  VW_BKN100.CP_COUNT
  */

  
  FROM BKN010 AS BKN010

  LEFT OUTER JOIN VW_BKN100 AS VW_BKN100
  ON	VW_BKN100.BKN100_NR_GRUPO = BKN010.BKN010_NR_BANCO
  AND	VW_BKN100.BKN100_NR_INST  = BKN010.BKN010_NR_CEDE
  AND   VW_BKN100.BKN100_NR_LOTE  = BKN010.BKN010_NR_LOTE

  LEFT OUTER JOIN BN004
  ON BN004.BN004_NR_PROD = BKN010_NR_PROD

GO


