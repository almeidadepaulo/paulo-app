-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BKN002]'))
DROP VIEW [dbo].[VW_BKN002]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BKN002]
WITH ENCRYPTION
AS

  SELECT 
  
  BKN002.BKN002_NR_BANCO,
  BKN002.BKN002_NR_CESS,
  BKN002.BKN002_NR_CNPJ,
  BKN002.BKN002_TP_FINAM,
  BKN002.BKN002_NM_CESS,
  BKN002.BKN002_NR_CBANCO,
  BKN002.BKN002_NR_CAGENC,
  BKN002.BKN002_NR_CCONTA,

  BKN002.BKN002_NR_OPESIS,
  BKN002.BKN002_DT_INCSIS,
  BKN002.BKN002_DT_ATUSIS,

  -- EXPORT CSV
  BKN002_TP_FINAM_EXPORT = (CASE
    							WHEN BKN002.BKN002_TP_FINAM = 'C' THEN 'Cessionário' 
								ELSE 'Própria'
							END), 


  
  VW_BKN001.BKN001_NR_BANCO,
  VW_BKN001.BKN001_NR_CNPJ,
  VW_BKN001.BKN001_NM_BANCO,
  VW_BKN001.BKN001_NR_OPESIS,
  VW_BKN001.BKN001_DT_INCSIS,
  VW_BKN001.BKN001_DT_ATUSIS,
  VW_BKN001.BKN001_NR_NM_BANCO,
  
  Cast(BKN002.BKN002_NR_CESS as varchar)+' - '+BKN002.BKN002_NM_CESS as BKN002_NR_NM_CESS
  
  
  FROM BKN002 AS BKN002
  LEFT OUTER JOIN VW_BKN001 AS VW_BKN001
  ON BKN002.BKN002_NR_BANCO = VW_BKN001.BKN001_NR_BANCO

GO


