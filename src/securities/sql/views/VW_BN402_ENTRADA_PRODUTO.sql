-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN402_ENTRADA_PRODUTO]'))
DROP VIEW [dbo].[VW_BN402_ENTRADA_PRODUTO]
GO

-- Entrada por Produto
-- Cria View
CREATE VIEW [dbo].[VW_BN402_ENTRADA_PRODUTO]
WITH ENCRYPTION
AS
 SELECT 
	BN402_NR_GRUPO,
	BN402_NR_INST,
	BN402_DT_MOVTO ,
	SUM(BN402_VL_VALOR)		BN402_VL_VALOR ,
	--SUM(CB209_QT_CONTRA)	CB209_QT_CONTRA,
	SUM(BN402_QT_TOTAL)		BN402_QT_TOTAL,
	BN402_NR_BANCO,
	BN402_NR_PROD,

	-- BANCO
	BN007_NM_BANCO,

	-- CARTEIRA
	--?CB256_DS_CART,

	-- PRODUTO
	BN004_NM_PROD,

	-- CESSIONÁRIO
	BN001_NM_GRUPO

 FROM BN402 AS CB2BN40209

 LEFT OUTER JOIN BN001
 ON BN001_NR_GRUPO = BN402_NR_GRUPO -- CESSIONÁRIO

 LEFT OUTER JOIN BN007 AS BN007  -- BANCO
 ON  BN007_NR_BANCO	=	BN402_NR_BANCO 

 --?LEFT OUTER JOIN CB256 AS CB256  -- CARTEIRA
 --?ON  CB256_CD_CART	=	CB209_CD_CART

 LEFT OUTER JOIN BN004 AS BN004  -- PRODUTO
 ON  BN004_NR_PROD	=	BN402_NR_PROD


 WHERE  BN402_TP_ACUM = 2 /* ENTRADA */

 GROUP BY 
  BN402_DT_MOVTO,
  BN402_NR_GRUPO,
  BN402_NR_INST,
  BN402_NR_BANCO,
  BN402_NR_PROD,
  BN007_NR_BANCO,
  BN007_NM_BANCO,
  --?CB256_DS_CART,
  BN004_NM_PROD,

  -- CESSIONÁRIO
  BN001_NM_GRUPO

GO

