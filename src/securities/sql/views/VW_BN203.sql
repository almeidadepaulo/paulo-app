-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN203]'))
DROP VIEW [dbo].[VW_BN203]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BN203]
WITH ENCRYPTION
AS
  SELECT 
  
	BN203.BN203_NR_GRUPO
	,BN203.BN203_NR_INST
	,BN203.BN203_NR_CNPJ
	,BN203.BN203_NR_REME
	,LTRIM(RTRIM(BN203.BN203_NR_CONTRAOR)) AS BN203_NR_CONTRAOR
	,BN203.BN203_NR_SEQ
	,BN203.BN203_NR_ERRO
	,BN203.BN203_NR_OPESIS
	,BN203.BN203_DT_INCSIS
	,BN203.BN203_DT_ATUSIS

	,BN015.BN015_TP_MENSAG
	,BN015.BN015_NR_MENSAG
	,BN015.BN015_NM_MENSAG
	,cast(BN015.BN015_NR_MENSAG as varchar)+' - '+BN015.BN015_NM_MENSAG as BN015_NR_NM_MENSAG
	/*
	,BN015.BN015_NR_OPESIS
	,BN015.BN015_DT_INCSIS
	,BN015.BN015_DT_ATUSIS*/

	,BN002.BN002_NM_INST
          
  FROM BN203 AS BN203

  LEFT OUTER JOIN BN002 AS BN002
  ON  (BN002.BN002_NR_GRUPO = BN203.BN203_NR_GRUPO
  AND BN002.BN002_NR_INST    = BN203.BN203_NR_INST)

  OR  (BN203.BN203_NR_GRUPO = 99999999	-- Sugerido por Paulo, pois ele joga o número do registrador no campo
  AND BN002.BN002_NR_INST   IN(SELECT BN023_NR_INST FROM BN023 WHERE BN023_NR_CETIP = BN203.BN203_NR_INST)
  )
  
  LEFT OUTER JOIN BN015 AS BN015
  ON BN203.BN203_NR_ERRO = BN015.BN015_NR_MENSAG
  
  WHERE BN015.BN015_TP_MENSAG IN(8,9,10,11,12,13,14,15)


GO


