-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN151]'))
DROP VIEW [dbo].[VW_BN151]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BN151]
WITH ENCRYPTION
AS
  SELECT 
  
  BN151.*,
  
  BN002.BN002_NR_GRUPO,
  BN002.BN002_NR_INST,
  BN002.BN002_NR_CNPJ,
  BN002.BN002_NM_INST,
  BN002.BN002_NR_OPESIS,
  BN002.BN002_DT_INCSIS,
  BN002.BN002_DT_ATUSIS,
  
  BN015.BN015_NR_MENSAG,
  BN015.BN015_NM_MENSAG
  
  FROM BN151 AS BN151
  
  INNER JOIN BN002 AS BN002
  ON BN151.BN151_NR_CNPJ = BN002.BN002_NR_CNPJ


  INNER JOIN VW_BN150 AS VW_BN150
  ON VW_BN150.BN150_NR_CNPJ		= BN151.BN151_NR_CNPJ
  AND VW_BN150.BN150_TP_MOVTO	= BN151.BN151_TP_MOVTO
  AND VW_BN150.BN150_NR_LOTE	= BN151.BN151_NR_LOTE
  AND VW_BN150.BN150_NR_CONTRA = BN151.BN151_NR_CONTRA
  AND VW_BN150.BN150_NR_SEQ	= BN151.BN151_NR_SEQ
  
  LEFT OUTER JOIN BN015 AS BN015
  ON BN151.BN151_NR_ERRO = BN015.BN015_NR_MENSAG

GO


