-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BKN100]'))
DROP VIEW [dbo].[VW_BKN100]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BKN100]
WITH ENCRYPTION
AS
  SELECT 

	BKN100.BKN100_NR_GRUPO,
	BKN100.BKN100_NR_INST,
	BKN100.BKN100_NR_CNPJ,
	BKN100.BKN100_NR_MKCESS,
	BKN100.BKN100_TP_MOVTO,
	BKN100.BKN100_NR_LOTE,
	BKN100.BKN100_CD_PROD,
	BKN100.BKN100_QT_CONRE,
	BKN100.BKN100_QT_GARRE,
	BKN100.BKN100_QT_PARRE,
	BKN100.BKN100_TT_PARRE,
	BKN100.BKN100_QT_CONLI,
	BKN100.BKN100_QT_GARLI,
	BKN100.BKN100_QT_PARLI,
	BKN100.BKN100_TT_PARLI,
	BKN100.BKN100_QT_CONDEV,
	BKN100.BKN100_QT_GARDEV,
	BKN100.BKN100_QT_PARDEV,
	BKN100.BKN100_TT_PARDEV,
	BKN100.BKN100_TT_PRES,
	BKN100.BKN100_TT_EXIG,
	BKN100.BKN100_ST_RETBCO,
	BKN100.BKN100_ST_RETCCC,
	BKN100.BKN100_QT_CONCCC,
	BKN100.BKN100_QT_GARCCC,
	BKN100.BKN100_QT_PARCCC,
	BKN100.BKN100_DT_GRAV,
	BKN100.BKN100_HR_GRAV,
	BKN100.BKN100_ST_LOTE,
	BKN100.BKN100_ST_ACAO,
	BKN100.BKN100_ST_PROC,
	BKN100.BKN100_DT_BASE,
	BKN100.BKN100_NR_OPESIS,
	BKN100.BKN100_DT_INCSIS,
	BKN100.BKN100_DT_ATUSIS

	,VW_CB050.CB050_NM_INST
	,VW_CB050.CB050_NR_NM_INST

	,CB053.CB053_CD_EMIEMP
	,CB053.CB053_DS_EMIEMP
  	
	,BN001.BN001_NM_GRUPO

	-- PRODUTO
	,BN004.BN004_NM_PROD
		
  FROM BKN100 AS BKN100
  
   -- GRUPO
  INNER JOIN VW_CB050 AS VW_CB050
  ON BKN100.BKN100_NR_GRUPO = VW_CB050.CB050_NR_INST
  
  -- CEDENTE
  INNER JOIN CB053 AS CB053
  ON  BKN100.BKN100_NR_GRUPO = CB053.CB053_NR_INST
  AND BKN100.BKN100_NR_INST  = CB053.CB053_CD_EMIEMP

  -- CESSINÁRIO
  LEFT OUTER JOIN BN001 AS BN001
  ON BKN100.BKN100_NR_MKCESS = BN001.BN001_NR_GRUPO

  LEFT OUTER JOIN BN004 AS BN004
  ON BN004_NR_PROD = BKN100.BKN100_CD_PROD
  