-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_BN003]'))
DROP VIEW [dbo].[VW_BN003]
GO

-- Cria View
CREATE VIEW [dbo].[VW_BN003]
WITH ENCRYPTION
AS
  SELECT
  
  BN003.BN003_NR_GRUPO,
  BN003.BN003_NR_INST,
  BN003.BN003_NR_BANCO,
  BN003.BN003_NR_AGENC,
  BN003.BN003_NR_CONTA,
  BN003.BN003_NR_OPESIS,
  BN003.BN003_DT_INCSIS,
  BN003.BN003_DT_ATUSIS, 
  
  VW_BN002.BN002_NR_GRUPO,
  VW_BN002.BN002_NR_INST,
  VW_BN002.BN002_NR_CNPJ,
  VW_BN002.BN002_NM_INST,
  VW_BN002.BN002_NR_OPESIS,
  VW_BN002.BN002_DT_INCSIS,
  VW_BN002.BN002_DT_ATUSIS,
  VW_BN002.BN001_NR_GRUPO,
  VW_BN002.BN001_NR_CNPJ,
  VW_BN002.BN001_NM_GRUPO,
  VW_BN002.BN001_NR_OPESIS,
  VW_BN002.BN001_DT_INCSIS,
  VW_BN002.BN001_DT_ATUSIS,
  VW_BN002.BN001_NR_NM_GRUPO,
  
  BN007.BN007_NR_BANCO,
  BN007.BN007_NM_BANCO,
  BN007.BN007_NR_OPESIS,
  BN007.BN007_DT_INCSIS,
  BN007.BN007_DT_ATUSIS,
  
  BN008.BN008_NR_BANCO,
  BN008.BN008_NR_AGENC,
  BN008.BN008_NM_AGENC,
  
  BN009.BN009_NM_CONTA,
  
  
  Cast(BN007.BN007_NR_BANCO as varchar)+' - '+BN007.BN007_NM_BANCO AS BN007_NR_NM_BANCO,
  Cast(BN008.BN008_NR_AGENC as varchar)+' - '+BN008.BN008_NM_AGENC AS BN008_NR_NM_AGENC
  
  FROM BN003 AS BN003
  
  INNER JOIN VW_BN002 AS VW_BN002 -- Instituição
  ON  VW_BN002.BN002_NR_GRUPO	= BN003.BN003_NR_GRUPO 
  AND VW_BN002.BN002_NR_INST	= BN003.BN003_NR_INST  
  
  INNER JOIN BN007 AS BN007 -- BANCO
  ON BN007.BN007_NR_BANCO	= BN003.BN003_NR_BANCO 
  
  INNER JOIN BN008 AS BN008
  ON  BN008.BN008_NR_BANCO	= BN003_NR_BANCO	 
  AND BN008_NR_AGENC		= BN003_NR_AGENC

  INNER JOIN BN009 AS BN009 -- NOME DA CONTA
  ON  BN009_NR_BANCO		= BN003_NR_BANCO
  AND BN009_NR_AGENC		= BN003_NR_AGENC
  AND BN009.BN009_NR_CONTA  = BN003.BN003_NR_CONTA

GO --


