-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB251]'))
DROP VIEW [dbo].[VW_CB251]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB251]
WITH ENCRYPTION
AS
  SELECT
  CB251.CB251_NR_OPERADOR,
  CB251.CB251_NR_CEDENTE,
  CB251.CB251_CD_COMPSC,
  CB251.CB251_NR_AGENC,
  CB251.CB251_NR_DGAGEN,
  CB251.CB251_NM_AGENC,
  CB251.CB251_NR_CNPJ,
  CB251.CB251_NM_END,
  CB251.CB251_NR_END,
  CB251.CB251_DS_COMPL,
  CB251.CB251_NM_BAIRRO,
  CB251.CB251_CD_CIDADE,
  CB251.CB251_NM_CIDADE,
  CB251.CB251_SG_ESTADO,
  CB251.CB251_CD_PAIS,
  CB251.CB251_NR_CEP,
  CB251.CB251_CD_OPESIS,
  CB251.CB251_DT_INCSIS,
  CB251.CB251_DT_ATUSIS,
  
  --Cast(CB251.CB251_NR_AGENC as varchar) +' - '+ CB251.CB251_NM_AGENC AS CB251_NR_NM_AGENC,
  CASE WHEN CB251_NR_DGAGEN <> '' THEN
	Cast(CB251.CB251_NR_AGENC as varchar) +'-'+ Cast(CB251.CB251_NR_DGAGEN as varchar)
  ELSE
	Cast(CB251_NR_AGENC as varchar)
  END CB251_NR_DG_AGENC,

  CB250.CB250_NM_BANCO,
  
  CB041.CB041_NM_LOCALI,

  CB251.CB251_NM_BAIRRO AS CB042_NM_BAIRR
  
  FROM CB251 AS CB251
  
  LEFT OUTER JOIN CB041 AS CB041  --CIDADE
  ON CB251.CB251_CD_CIDADE = CB041.CB041_CD_LOCALI
  AND CB251.CB251_SG_ESTADO = CB041.CB041_CD_ESTBR
  
  LEFT OUTER JOIN CB250 AS CB250  -- BANCO
  ON  CB251.CB251_NR_OPERADOR = CB250.CB250_NR_OPERADOR
  AND CB251.CB251_NR_CEDENTE  = CB250.CB250_NR_CEDENTE
  AND CB251.CB251_CD_COMPSC   = CB250.CB250_CD_COMPSC  

GO