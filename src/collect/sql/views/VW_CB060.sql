-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB060]'))
DROP VIEW [dbo].[VW_CB060]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB060]
WITH ENCRYPTION
AS
  SELECT
    CB060.CB060_NR_INST,
  	CB060.CB060_CD_EMIEMP,
  	CB060.CB060_CD_PUBLIC,
  	CB060.CB060_DS_PUBLIC,
  	CB060.CB060_CD_LOC,
  	CB060.CB060_DT_EXPIRA,
  	CB060.CB060_TP_ARQ,
	CASE 
	WHEN CB060.CB060_TP_ARQ = 1 THEN 'PDF'
	WHEN CB060.CB060_TP_ARQ = 2 THEN 'JPG'
	WHEN CB060.CB060_TP_ARQ = 3 THEN 'BMP'
    WHEN CB060.CB060_TP_ARQ = 4 THEN 'DOC'
	ELSE 'TIF'
	END CB060_TP_ARQ_L,
	CB060.CB060_ID_ARQ,
  	CASE 
	WHEN CB060.CB060_ID_ARQ = 'S' THEN 'SIM'
	WHEN CB060.CB060_ID_ARQ = 'N' THEN 'N√ÉO'
	ELSE CB060.CB060_ID_ARQ
	END CB060_ID_ARQ_L,
  	CB060.CB060_TP_DOC,
  	CB060.CB060_NM_FORMAT,
  	CB060.CB060_CD_FORNEC,
  	CB060.CB060_CD_OPESIS,
  	CB060.CB060_DT_INCSIS,
  	CB060.CB060_DT_ATUSIS,
  
    CB050.CB050_NR_INST,
  	CB050.CB050_NM_INST,
  	CB050.CB050_NM_INSTR,
  	CB050.CB050_CD_OPESIS,
  	CB050.CB050_DT_INCSIS,
  	CB050.CB050_DT_ATUSIS,
    Cast(CB050.CB050_NR_INST as varchar) +' - '+ CB050.CB050_NM_INST AS CB050_NR_NM_INST,
    
    CB035.CB035_DS_LOC,
    
    CB055.CB055_NM_FORNEC,
    
    CB053.CB053_DS_EMIEMP
    
  FROM CB060 AS CB060
  
  LEFT OUTER JOIN CB055 AS CB055
  ON CB060.CB060_CD_FORNEC = CB055.CB055_CD_FORNEC
  AND CB060.CB060_NR_INST = CB055.CB055_NR_INST
  
  LEFT OUTER JOIN CB035 AS CB035
  ON CB060.CB060_CD_LOC = CB035.CB035_CD_LOC
  AND CB060.CB060_NR_INST = CB035.CB035_NR_INST
  
  LEFT OUTER JOIN CB053 AS CB053
  ON CB060.CB060_CD_EMIEMP = CB053.CB053_CD_EMIEMP
  AND CB060.CB060_NR_INST = CB053.CB053_NR_INST
  
  LEFT OUTER JOIN CB050 AS CB050
  ON CB060.CB060_NR_INST = CB050.CB050_NR_INST -- Teste
  
GO