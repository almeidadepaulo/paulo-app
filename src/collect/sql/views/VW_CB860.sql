-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB860]'))
DROP VIEW [dbo].[VW_CB860]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB860]
WITH ENCRYPTION
AS
 SELECT
  CB860_NR_OPERADOR,
  CB860_NR_CEDENTE,
  CB860_TP_REL,
  CB860_DT_REL,
  --CB860_HR_REL,
  CASE WHEN LEN(CONVERT(NUMERIC, CB860_HR_REL)) = 4 THEN SUBSTRING(CONVERT(CHAR(4),CB860_HR_REL),1,2)+':'+SUBSTRING(CONVERT(CHAR(4),CB860_HR_REL),3,2)
      WHEN LEN(CONVERT(NUMERIC, CB860_HR_REL)) = 3 THEN '0'+SUBSTRING(CONVERT(CHAR(3),CB860_HR_REL),1,1)+':'+SUBSTRING(CONVERT(CHAR(3),CB860_HR_REL),2,2)
	  ELSE '00:00'
	  END CB860_HR_REL ,
  CB860_IM_PDF,
  CB860_CD_OPESIS,
  CB860_DT_INCSIS,
  CB860_DT_ATUSIS
  
  FROM CB860 AS CB860
  	
GO