-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB210_PT]'))
DROP VIEW [dbo].[VW_CB210_PT]
GO

-- Posição de títulos
-- Cria View
CREATE VIEW [dbo].[VW_CB210_PT]
WITH ENCRYPTION
AS
    SELECT
		CB210.CB210_NR_OPERADOR,
		CB210.CB210_NR_CEDENTE,
		CB210.CB210_CD_COMPSC ,
		CB210.CB210_NR_AGENC  ,
		CB210.CB210_NR_CONTA  ,
		CB210.CB210_NR_CONTRA ,
		CB210.CB210_NR_PRODUT ,
		CB210.CB210_CD_CART   ,
		CB255.CB255_DS_PROD   ,
		CB210.CB210_NR_NOSNUM ,
		CB210.CB210_NR_CPFCNPJ,
		CB210.CB210_NR_PROTOC,
		CB210.CB210_DT_VCTO  ,
		CB210.CB210_VL_VALOR ,
		CB210.CB210_ID_SITPAG,
		CB210.CB210_TP_BAIXA,
	CASE
		WHEN CB210.CB210_ID_SITPAG = 1 THEN 'Pago'
		WHEN CB210.CB210_ID_SITPAG = 2 THEN 'Em Aberto'
		ELSE ''
	END CB210_ID_SITPAG_label,
	CASE
		WHEN CB210.CB210_TP_BAIXA = 0 THEN 'Em Aberto'
		WHEN CB210.CB210_TP_BAIXA = 1 THEN 'Pago'
		WHEN CB210.CB210_TP_BAIXA = 2 THEN 'Devolução'
		WHEN CB210.CB210_TP_BAIXA = 3 THEN 'Baixa Financeira'
		WHEN CB210.CB210_TP_BAIXA = 4 THEN 'Cancelamento'
		WHEN CB210.CB210_TP_BAIXA = 5 THEN 'BNDU'
	ELSE 'Indefinido'
	END CB210_TP_BAIXA_label,
	CB210.CB210_DT_INCSIS,
	CB210.CB210_DT_ATUSIS,
	CB201_NM_NMSAC

    FROM
      CB210 AS CB210

	INNER JOIN CB255 AS CB255
	ON  CB255.CB255_CD_PROD = CB210_NR_PRODUT
	AND CB255.CB255_NR_OPERADOR = CB210_NR_OPERADOR
	AND CB255.CB255_NR_CEDENTE = CB210_NR_CEDENTE

	INNER JOIN CB201
	ON CB201_NR_OPERADOR = CB210_NR_OPERADOR
	AND CB201_NR_CEDENTE = CB210_NR_CEDENTE
	AND CB201_CD_COMPSC = CB210_CD_COMPSC 
	AND CB201_NR_AGENC  = CB210_NR_AGENC 
	AND CB201_NR_CONTA  = CB210_NR_CONTA 
	AND CB201_NR_NOSNUM = CB210_NR_NOSNUM
	AND CB201_NR_CPFCNPJ = CB210_NR_CPFCNPJ


GO