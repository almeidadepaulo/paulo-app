-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB218]'))
DROP VIEW [dbo].[VW_CB218]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB218]
WITH ENCRYPTION
AS
  SELECT 
  	CB218_NR_CONTRA,
  	CB218_NR_PROTOC,
  	--CB218_DT_ABERTU,
  	CASE WHEN LEN(CB218_DT_ABERTU) = 8 THEN SUBSTRING(CONVERT(CHAR(8),CB218_DT_ABERTU),1,2)+'/'+SUBSTRING(CONVERT(CHAR(8),CB218_DT_ABERTU),3,2)+'/'+SUBSTRING(CONVERT(CHAR(8),CB218_DT_ABERTU),5,4)
      WHEN LEN(CB218_DT_ABERTU) = 7 THEN '0'+SUBSTRING(CONVERT(CHAR(7),CB218_DT_ABERTU),1,1)+'/'+SUBSTRING(CONVERT(CHAR(7),CB218_DT_ABERTU),2,2)+'/'+SUBSTRING(CONVERT(CHAR(7),CB218_DT_ABERTU),4,4)
	  ELSE '00/00/0000'
	  END CB218_DT_ABERTU,
  	CB218_DT_RESOLU,
  	CB218_NM_USR,
  	CB218_NR_CPFCLI,
  	CB218_NR_INDICA,
  	CB218_CD_OPESIS,
  	CB218_DT_INCSIS,
  	CB218_DT_ATUSIS
  
  FROM CB218

GO


