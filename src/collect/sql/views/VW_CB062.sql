-- Configura View

SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB062]'))
DROP VIEW [dbo].[VW_CB062]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB062]
WITH ENCRYPTION
AS
  SELECT
    CB062.CB062_NR_INST,
  	CB062.CB062_CD_EMIEMP,
  	CB062.CB062_CD_PUBLIC,
  	CB062.CB062_CD_TARIFA,
  	CB062.CB062_DT_VALID,
  	CB062.CB062_DT_ENCERR,
  	CB062.CB062_VL_CUSPUB,
  	CB062.CB062_VL_CUSPOS,
  	CB062.CB062_VL_CUSCAP,
  	CB062.CB062_VL_CUSINS,
  	CB062.CB062_ID_ATVINA,
  	CB062.CB062_CD_OPESIS,
  	CB062.CB062_DT_INCSIS,
  	CB062.CB062_DT_ATUSIS,
  
    CB050.CB050_NR_INST,
  	CB050.CB050_NM_INST,
  	CB050.CB050_NM_INSTR,
  	CB050.CB050_CD_OPESIS,
  	CB050.CB050_DT_INCSIS,
  	CB050.CB050_DT_ATUSIS,
    Cast(CB050.CB050_NR_INST as varchar) +' - '+ CB050.CB050_NM_INST AS CB050_NR_NM_INST,
    
    CB060.CB060_DS_PUBLIC,
    
    CB053.CB053_DS_EMIEMP
    
  FROM CB062 AS CB062
  
  LEFT OUTER JOIN CB060 AS CB060
  ON CB062.CB062_CD_PUBLIC = CB060.CB060_CD_PUBLIC
  AND CB062.CB062_NR_INST = CB060.CB060_NR_INST
    
  LEFT OUTER JOIN CB053 AS CB053
  ON CB062.CB062_CD_EMIEMP = CB053.CB053_CD_EMIEMP
  AND CB062.CB062_NR_INST = CB053.CB053_NR_INST
  
  LEFT OUTER JOIN CB050 AS CB050
  ON CB062.CB062_NR_INST = CB050.CB050_NR_INST -- Teste
  
GO