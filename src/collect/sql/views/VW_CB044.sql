-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB044]'))
DROP VIEW [dbo].[VW_CB044]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB044]
WITH ENCRYPTION
AS
  SELECT
    CB044.CB044_CD_LOCALI,
  	CB044.CB044_CD_LOGRAD,
  	CB044.CB044_CD_ESTBR,
  	CB044.CB044_CD_BAIRRI,
  	CB044.CB044_CD_BAIRRF,
  	CB044.CB044_NM_LOGRAD,
  	CB044.CB044_NM_COMPL,
  	CASE
  	WHEN CB044.CB044_NR_CEP = 0 THEN '00.000-000'
  	ELSE SUBSTRING(CONVERT(CHAR(8),CB044.CB044_NR_CEP),1,2)+'.'+SUBSTRING(CONVERT(CHAR(8),CB044.CB044_NR_CEP),3,3)+'-'+SUBSTRING(CONVERT(CHAR(8),CB044.CB044_NR_CEP),6,3)
  	END CB044_NR_CEP,
  	CB044.CB044_TP_LOGRAD,
  	CB044.CB044_NM_LOGABR,
  	CB044.CB044_CD_OPESIS,
  	CB044.CB044_DT_INCSIS,
  	CB044.CB044_DT_ATUSIS,
  
    CB041.CB041_NM_LOCALI
    
  FROM CB044 AS CB044
  LEFT OUTER JOIN CB041 AS CB041
  ON CB044.CB044_CD_LOCALI = CB041.CB041_CD_LOCALI -- Teste

GO