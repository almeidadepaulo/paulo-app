-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB052]'))
DROP VIEW [dbo].[VW_CB052]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB052]
WITH ENCRYPTION
AS
  SELECT
    CB052.CB052_NR_INST,
  	CB052.CB052_CD_SIST,
  	CB052.CB052_CD_PROD,
  	CB052.CB052_DS_PROD,
  	CB052.CB052_DS_PRODR,
  	CB052.CB052_ID_PERIOD,
  	CASE 
	WHEN CB052.CB052_ID_PERIOD = 1 THEN 'Dia'
	WHEN CB052.CB052_ID_PERIOD = 2 THEN 'MÃªs'
	WHEN CB052.CB052_ID_PERIOD = 3 THEN 'Semanal'
	WHEN CB052.CB052_ID_PERIOD = 4 THEN 'Quinzenal'
	WHEN CB052.CB052_ID_PERIOD = 5 THEN 'Eventual'
	ELSE 'Indefinido'
	END CB052_ID_PERIOD_L,
  	CB052.CB052_CD_OPESIS,
  	CB052.CB052_DT_INCSIS,
  	CB052.CB052_DT_ATUSIS,
  
    CB050.CB050_NR_INST,
  	CB050.CB050_NM_INST,
  	CB050.CB050_NM_INSTR,
  	CB050.CB050_CD_OPESIS,
  	CB050.CB050_DT_INCSIS,
  	CB050.CB050_DT_ATUSIS,
    Cast(CB050.CB050_NR_INST as varchar) +' - '+ CB050.CB050_NM_INST AS CB050_NR_NM_INST,
    
    CB051.CB051_NM_SIST,
    Cast(CB051.CB051_CD_SIST as varchar) +' - '+ CB051.CB051_NM_SIST AS CB051_CD_NM_SIST
    
  FROM CB052 AS CB052
  
  LEFT OUTER JOIN CB051 AS CB051
  ON CB052.CB052_CD_SIST = CB051.CB051_CD_SIST
  AND CB052.CB052_NR_INST = CB051.CB051_NR_INST

  LEFT OUTER JOIN CB050 AS CB050
  ON CB052.CB052_NR_INST = CB050.CB050_NR_INST -- Teste
  
GO