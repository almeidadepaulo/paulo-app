-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB210_2VIA]'))
DROP VIEW [dbo].[VW_CB210_2VIA]
GO

-- Tela Cliente - Posi��o de Titulos
-- Cria View
CREATE VIEW [dbo].[VW_CB210_2VIA]
WITH ENCRYPTION
AS
    SELECT 
	  CB210.CB210_NR_OPERADOR,
	  CB210.CB210_NR_CEDENTE,
    CB210.CB210_CD_COMPSC ,
    CB210.CB210_NR_AGENC  ,
    CB210.CB210_NR_CONTA  ,
    CB210.CB210_NR_PRODUT ,
    CB210.CB210_NR_CONTRA ,
    CB210.CB210_NR_NOSNUM ,
    CB210.CB210_NR_CPFCNPJ,
    CB210.CB210_NR_PROTOC ,
    CB210.CB210_DT_VCTO   ,
    CB210.CB210_DT_VCTO as CB210_DT_VCTO_DD,
    CB210.CB210_VL_VALOR  ,	  
	  CB210_ID_SITPAG,
	  CB210_ID_SITPAG_LABEL =
		CASE 
  		   WHEN CB210_ID_SITPAG = '1' THEN 'Pago'
		   WHEN CB210_ID_SITPAG = '2' THEN 'Em aberto'
		   WHEN CB210_ID_SITPAG = '3' THEN 'Baixa Fianceira'
		   WHEN CB210_ID_SITPAG = '4' THEN 'Cancelamento'
		   WHEN CB210_ID_SITPAG = '5' THEN 'BNDU'
		   ELSE ''
		END,
    CB210.CB210_DT_INCSIS,
    CB203.CB203_DT_EMISS  ,
	  CB203.CB203_DT_VCTOT  ,
	  CB203.CB203_VL_TITULO ,
	  CB203.CB203_VL_JURMOR ,
	  CB203.CB203_VL_JURMOR+CB203.CB203_VL_TITULO AS VL_TOTAL ,
    CB201_NM_NMSAC  ,
    CB201_NM_END    ,
    CB201_NR_END    ,
    CB201_DS_COMPL  ,
    CB201_NM_BAIRRO ,
    CB201_NM_CIDADE ,
    CB201_SG_ESTADO ,
    CB201_CD_PAIS   ,
    CB201_NR_CEP    ,
    CB201_NR_DDD    ,
    CB201_NR_TEL    ,
    CB201_NR_CEL    ,
    CB201_NM_EMAIL  ,
    CB255.CB255_DS_PROD   ,
	  CB850.CB850_NR_PROTOC ,
	  DATEDIFF(DD, CONVERT(DATETIME, CONVERT(CHAR(8), CB210.CB210_DT_VCTO)), getDate()) CB210_NR_DIAATR
      
    FROM
      CB210 as CB210
  
  INNER JOIN CB201
  ON CB201_NR_OPERADOR = CB210_NR_OPERADOR
  AND CB201_NR_CEDENTE = CB210_NR_CEDENTE
  AND CB201_CD_COMPSC = CB210_CD_COMPSC 
  AND CB201_NR_AGENC  = CB210_NR_AGENC 
  AND CB201_NR_CONTA  = CB210_NR_CONTA 
  AND CB201_NR_NOSNUM = CB210_NR_NOSNUM
  AND CB201_NR_CPFCNPJ = CB210_NR_CPFCNPJ

  INNER  JOIN  CB203 AS CB203
  ON   CB203.CB203_NR_OPERADOR = CB210.CB210_NR_OPERADOR
  AND CB203.CB203_NR_CEDENTE  = CB210.CB210_NR_CEDENTE
  AND CB203.CB203_CD_COMPSC   = CB210.CB210_CD_COMPSC
  AND CB203.CB203_NR_AGENC    = CB210.CB210_NR_AGENC
  AND CB203.CB203_NR_CONTA    = CB210.CB210_NR_CONTA
  AND CB203.CB203_NR_NOSNUM   = CB210.CB210_NR_NOSNUM
      
  INNER JOIN  CB255 AS CB255
  ON  CB255.CB255_NR_OPERADOR = CB210.CB210_NR_OPERADOR
  AND CB255.CB255_NR_CEDENTE  = CB210.CB210_NR_CEDENTE
  AND CB255.CB255_CD_PROD     = CB210.CB210_NR_PRODUT  
  
  INNER  JOIN  CB850 AS CB850
  ON  CB850.CB850_NR_PROTOC = CB210.CB210_NR_PROTOC  
GO

