-- Configurar View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apagar view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB810_DOWNLOAD]'))
DROP VIEW [dbo].[VW_CB810_DOWNLOAD]
GO

-- Criar View
CREATE VIEW [dbo].[VW_CB810_DOWNLOAD]
WITH ENCRYPTION
AS
  SELECT 
  L1.CB810_NR_OPERADOR,
  L1.CB810_NR_CEDENTE,
  L1.CB810_CD_COMPSC,
  L1.CB810_NR_AGENC,
  L1.CB810_NR_CONTA,
  L1.CB810_NR_SEQ,
  L1.CB810_NR_TRANS,
  L1.CB810_NM_ARQOR,
  L1.CB810_NM_ARQ,
  L1.CB810_DT_PROCC, 
  L1.CB810_TP_ARQ,
  L1.CB810_ST_PROCESS,
  L1.CB810_ST_DOWN,
  L1.CB810_CD_OPESIS,
  L1.CB810_DT_INCSIS,
  L1.CB810_DT_ATUSIS
FROM 
  CB810 AS L1
INNER JOIN 
  (SELECT CB810_NR_TRANS, MAX(CB810_NR_SEQ) AS ULTSEQ FROM CB810 AS L2 GROUP BY CB810_NR_TRANS) AS L2
ON 
  L1.CB810_NR_SEQ = L2.ULTSEQ

GO