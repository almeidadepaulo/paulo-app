-- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apaga view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_CB250]'))
DROP VIEW [dbo].[VW_CB250]
GO

-- Cria View
CREATE VIEW [dbo].[VW_CB250]
WITH ENCRYPTION
AS
  SELECT 
  CB250.CB250_NR_OPERADOR,
  CB250.CB250_NR_CEDENTE,
  CB250.CB250_CD_COMPSC,
  CB250.CB250_NM_BANCO,
  CB250.CB250_NR_CNPJ,
  CB250.CB250_NM_END,
  CB250.CB250_NR_END,
  CB250.CB250_DS_COMPL,
  CB250.CB250_NM_BAIRRO,
  CB250.CB250_CD_CIDADE,
  CB250.CB250_NM_CIDADE,
  CB250.CB250_SG_ESTADO,
  CB250.CB250_CD_PAIS,
  CASE WHEN CB250.CB250_NR_CEP = '0' THEN '00.000-000'
  WHEN CB250.CB250_NR_CEP = '' THEN ''
  ELSE SUBSTRING(CB250.CB250_NR_CEP,1,2)+'.'+SUBSTRING(CB250.CB250_NR_CEP,3,3)+'-'+SUBSTRING(CB250.CB250_NR_CEP,6,3)
  END CB250_NR_CEP,
  CB250.CB250_NR_NOSNUM,
  CB250.CB250_CD_OPESIS,
  CB250.CB250_DT_INCSIS,
  CB250.CB250_DT_ATUSIS,
  
  Cast(CB250.CB250_CD_COMPSC as varchar) +' - '+ CB250.CB250_NM_BANCO AS CB250_NR_NM_BANCO,
  
  CB041.CB041_NM_LOCALI,
    
  CB042.CB042_NM_BAIRR
  
  
  FROM CB250 AS CB250
  
   LEFT OUTER JOIN CB042 AS CB042
  ON CB250.CB250_CD_CIDADE = CB042.CB042_CD_LOCALI
  AND CB250.CB250_NM_BAIRRO = CB042.CB042_NM_BAIRR
  
  LEFT OUTER JOIN CB041 AS CB041
  ON CB250.CB250_CD_CIDADE = CB041.CB041_CD_LOCALI

GO


