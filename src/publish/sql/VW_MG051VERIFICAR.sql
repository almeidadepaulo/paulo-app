 -- Configura View
SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO

-- Apagar view
IF  EXISTS (SELECT * FROM sys.views WHERE object_id = OBJECT_ID(N'[dbo].[VW_MG051]'))
DROP VIEW [dbo].[VW_MG051]
GO

CREATE VIEW [dbo].[VW_MG051]
WITH ENCRYPTION
AS

SELECT
  MG051_NR_OPERADOR,
  MG051_NR_CEDENTE, 
  CB050_NM_INST  ,
  MG051_NR_BROKER,
  MG050_NM_BROKER,
  MG051_CD_TARIFA,
  MG051_DT_VALID ,
  MG051_DT_ENCERR,
  MG051_QT_INI   ,
  MG051_QT_FIM   ,
  MG051_VL_CUSTO ,
  MG051_ID_ATIVO ,  
  MG051_ID_ATIVO_label = CASE MG051_ID_ATIVO
    WHEN 1 THEN 'Ativa'      
    ELSE 'Inativa'
  END,
  MG051_CD_OPESIS,
  MG051_DT_INCSIS,
  MG051_DT_ATUSIS
FROM
  MG051
/* OPERADOR */  
INNER JOIN CB050
ON CB050_NR_INST = MG051_NR_OPERADOR
/* CEDENTE */
INNER JOIN CB053
ON CB053_NR_INST = MG051_NR_OPERADOR
AND CB053_CD_EMIEMP = MG051_NR_CEDENTE
/* BROKER */
INNER JOIN MG050
ON MG050_NR_OPERADOR = MG051_NR_OPERADOR
AND MG050_NR_CEDENTE = MG051_NR_CEDENTE
AND MG050_NR_BROKER = MG051_NR_BROKER

GO